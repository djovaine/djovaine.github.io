<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>3D Flower</title>
<style>
  /* ================= Jovaine ================== */
  :root {
    --size: 10vmin;
    --grad-size: calc(var(--size) / 3);
  }

  html, body {
    height: 100%;
    overflow: hidden;
    margin: 0;
  }

  body {
    background: hsl(0, 0%, 4%);
    background-image:
      linear-gradient(hsl(0, 0%, 6%) 1px, transparent 1px),
      linear-gradient(to right, hsl(0, 0%, 6%) 1px, transparent 1px);
    background-size: var(--grad-size) var(--grad-size);
    font-family: Arial, sans-serif;
  }

  .range {
    /* display: none; */
    position: absolute;
    z-index: 2;
  }

  .wrapper {
    position: absolute;
    top: 0; right: 0; bottom: 0; left: 0;
    margin: auto;
    width: var(--size);
    height: var(--size);
    font-size: var(--size);
    transform: rotateX(-45deg);
    transform-style: preserve-3d;
  }

  .flower {
    width: var(--size);
    height: var(--size);
    animation: rotate-flower 10s linear infinite;
    transform-style: preserve-3d;
    position: relative;
  }

  .flower:before {
    content: '';
    display: block;
    position: absolute;
    width: 95%;
    height: 95%;
    top: 0; right: 0; bottom: 0; left: 0;
    margin: auto;
    background: hsl(100, 100%, 20%);
    border-radius: 50%;
    transform: rotateX(90deg);
    animation: rotate-hue 5s infinite;
  }

  .petal {
    position: absolute;
    z-index: 20;
    bottom: 80%;
    left: calc(-1 * var(--size));
    transform-style: preserve-3d;
    transform-origin: bottom;
  }

  .box {
    width: calc(var(--size) * 3);
    transform-style: preserve-3d;
    transform-origin: bottom;
    animation: rotate-box 12s infinite;
  }

  .shape {
    width: 0.5em;
    height: 0.5em;
    margin: auto;
    background: currentColor;
    box-shadow:
      0.5em 0 0 0,
      1em 0 0 0,
      -1em 0 0 0,
      -0.5em 0 0 0;
    border-radius: 50%;
    animation: rotate-hue 5s infinite;
  }

  @keyframes rotate-box {
    0%   { transform: rotateX(3.5deg); }
    15%  { transform: rotateX(3.5deg); }
    50%  { transform: rotateX(-7deg); }
    80%  { transform: rotateX(-7deg); }
    100% { transform: rotateX(3.5deg); }
  }

  @keyframes rotate-flower {
    100% {
      transform: rotateY(360deg);
    }
  }

  @keyframes rotate-hue {
    100% {
      filter: hue-rotate(360deg);
    }
  }
</style>
</head>
<body>

<div class="wrapper">
  <div class="flower"></div>
</div>

<script>
  console.clear();

  const doc = document;
  const flower = doc.querySelector('.flower');

  const maxParts = 20;
  const maxPetals = 6;
  const partsFontStep = 25 / maxParts;
  const huetStep = 150 / maxParts;

  createFlower();

  function createFlower() {
    const angle = 360 / maxPetals;
    for(let i = 0; i < maxPetals; i++) {
      const petal = createPetal();
      const currAngle = angle * i + 'deg';
      const transform = `transform: rotateY(${currAngle}) rotateX(-30deg) translateZ(9vmin)`;
      petal.setAttribute('style', transform);
      flower.appendChild(petal);
    }
  }

  function createPetal() {
    let box = createBox(null, 0);

    const petal = doc.createElement('div');
    petal.classList.add('petal');

    for(let i = 1; i <= maxParts; i++) {
      const newBox = createBox(box, i);
      box = newBox;
    }

    petal.appendChild(box);
    return petal;
  }

  function createBox(box, pos) {
    let fontSize = partsFontStep * (maxParts - pos) + 'vmin';
    const half = maxParts / 2;
    let bright = 50;

    if (pos < half + 1) {
      fontSize = partsFontStep * pos + 'vmin';
    } else {
      bright = 10 + 40 / half * (maxParts - pos);
    }

    const color = `hsl(${huetStep * pos}, 100%, ${bright}%)`;

    // Create shape
    const newShape = doc.createElement('div');
    newShape.classList.add('shape');

    // Create box wrapper
    const newBox = doc.createElement('div');
    newBox.classList.add('box');
    newBox.style.color = color;
    newBox.style.fontSize = fontSize;

    // Append old box into new box
    if(box) newBox.appendChild(box);

    // Append shape to new box
    newBox.appendChild(newShape);

    return newBox;
  }
</script>

</body>
</html>
